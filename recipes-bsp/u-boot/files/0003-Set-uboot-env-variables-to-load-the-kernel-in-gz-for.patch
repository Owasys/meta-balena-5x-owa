From 1e7305e0c663334c61be0bb978842ef0f9076541 Mon Sep 17 00:00:00 2001
From: Alvaro Guzman <alvaro.guzman@owasys.com>
Date: Tue, 9 Aug 2022 16:09:40 +0200
Subject: [PATCH 03/10] Set uboot env variables to load the kernel in gz format
 from the resin-boot partition

---
 include/configs/imx8mp_owa5x.h | 5 ++---
 1 file changed, 2 insertions(+), 3 deletions(-)

diff --git a/include/configs/imx8mp_owa5x.h b/include/configs/imx8mp_owa5x.h
index cc0c9ae3..ae560076 100644
--- a/include/configs/imx8mp_owa5x.h
+++ b/include/configs/imx8mp_owa5x.h
@@ -101,7 +101,7 @@
          "fi; " \
       "fi;" \
       "run nandboot;\0" \
-	"bootcmd=run boot_owa5x\0" \
+	"bootcmd=run BOOT_CMD_BALENA\0" \
    "update_owa5x=" \
       "if test ${updatefw} != 1; then " \
          "echo Nothing to update; " \
@@ -199,7 +199,7 @@
 	"mmcroot=" CONFIG_MMCROOT " rootwait quiet rw mtdparts\0" \
 	"mmcautodetect=yes\0" \
 	"mmcargs=setenv bootargs ${jh_clk} console=${console} root=${mmcroot}\0 " \
-	"setenv bootargs ${resin_kernel_root} ${root_opt} ${os_cmdline};\0" \
+	"BOOT_CMD_BALENA=run mmcargs; fatload mmc 1:1 ${loadaddr} ${image}; fatload mmc 1:1 ${fdt_addr} ${fdt_file}; bootz ${loadaddr} - ${fdt_addr};\0" \
 	"startmmcboot=echo Booting from mmc ...; " \
 		"run mmcargs; " \
 		"if test ${boot_fit} = yes || test ${boot_fit} = try; then " \
@@ -245,7 +245,6 @@
 	"loadimage=fatload mmc ${mmcdev}:${mmcpart} ${loadaddr} ${image}\0" \
 	"loadfdt=fatload mmc ${mmcdev}:${mmcpart} ${fdt_addr} ${fdt_file}\0" \
 	"image=Image.gz\0" \
-	"zip_addr=0x70480000\0" \
 	"netargs=setenv bootargs ${jh_clk} console=${console} " \
 		"root=/dev/nfs " \
 		"ip=dhcp nfsroot=${serverip}:${nfsroot},v3,tcp\0" \
-- 
2.25.1

