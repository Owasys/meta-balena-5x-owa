From da84b63c912e0645d01133a8a2b5b8c7e0d155e1 Mon Sep 17 00:00:00 2001
From: Alvaro Guzman <alvaro.guzman@owasys.com>
Date: Fri, 29 Jul 2022 12:40:21 +0200
Subject: [PATCH 2/2] Set balena bootcmd

---
 include/configs/imx8mp_owa5x.h | 9 ++++++++-
 1 file changed, 8 insertions(+), 1 deletion(-)

diff --git a/include/configs/imx8mp_owa5x.h b/include/configs/imx8mp_owa5x.h
index 83b49128..d905a9b8 100644
--- a/include/configs/imx8mp_owa5x.h
+++ b/include/configs/imx8mp_owa5x.h
@@ -101,7 +101,14 @@
          "fi; " \
       "fi;" \
       "run nandboot;\0" \
-	"bootcmd=run boot_owa5x\0" \
+	"bootcmd=run BOOT_CMD_BALENA\0" \
+	"BOOT_CMD_BALENA=setenv resin_kernel_load_addr ${kernel_addr_r};" \
+	"run resin_set_kernel_root;" \
+	"run findfdt;" \
+	"setenv bootargs ${resin_kernel_root} rootfstype=ext4 rootwait console=$console;" \
+	"fatload ${resin_dev_type} ${resin_dev_index}:${resin_boot_part} ${resin_kernel_load_addr} zimage;" \
+	"fatload ${resin_dev_type} ${resin_dev_index}:${resin_boot_part} ${fdt_addr_r} ${fdtfile};" \
+	"bootz ${resin_kernel_load_addr} - ${fdt_addr_r}\0" \
    "update_owa5x=" \
       "if test ${updatefw} != 1; then " \
          "echo Nothing to update; " \
-- 
2.25.1

